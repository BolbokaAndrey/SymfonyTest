{% extends 'base.html.twig' %}

{% block title %}Свойства - Админка{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/admin.css') }}">
{% endblock %}

{% block body %}
    <div class="layout">
        {% include 'admin/components/sidebar.html.twig' %}
        <main class="content">
                {% embed 'admin/components/header.html.twig' %}
                    {% block header_actions %}
                        {% if is_granted('ROLE_ADMIN') %}
                            <a href="{{ path('admin_properties_new') }}" class="btn">Новое свойство
                            </a>
                        {% endif %}
                    {% endblock %}
                {% endembed %}

            <div class="properties-container">
                {% if properties is empty %}
                    <div class="empty-state">
                        <p>Свойств пока нет. {% if is_granted('ROLE_ADMIN') %}Хотите создать первое?{% endif %}</p>
                        {% if is_granted('ROLE_ADMIN') %}
                        <a href="{{ path('admin_properties_new') }}" class="btn">
                            <i class="fas fa-plus"></i> Создать свойство
                        </a>
                        {% endif %}
                    </div>
                {% else %}
                    <div class="card">
                        <table class="properties-table">
                            <thead>
                            <tr>
                                <th>Название</th>
                                <th>Описание</th>
                                <th>Код</th>
                                <th>Тип</th>
                                <th>Обязательное</th>
                                <th>Множественное</th>
                                <th>Действия</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for property in properties %}
                                <tr>
                                    <td class="font-medium">
                                        {{ property.name }}
                                    </td>
                                    <td class="text-muted">
                                        {{ property.description ?? '-' }}
                                    </td>
                                    <td>
                                        <code>{{ property.code }}</code>
                                    </td>
                                    <td>
                                            <span class="badge badge-warning">
                                                {{ property.type }}
                                            </span>
                                    </td>
                                    <td>
                                            <span class="badge {{ property.isRequired ? 'badge-danger' : 'badge-success' }}">
                                                {{ property.isRequired ? 'Да' : 'Нет' }}
                                            </span>
                                    </td>
                                    <td>
                                            <span class="badge {{ property.isMultiple ? 'badge-warning' : 'badge-success' }}">
                                                {{ property.isMultiple ? 'Да' : 'Нет' }}
                                            </span>
                                    </td>
                                    <td class="property-actions">
                                        {% if is_granted('ROLE_ADMIN') %}
                                        <a href="{{ path('admin_properties_edit', {'id': property.id}) }}" class="btn btn-edit">
                                            <span>Изменить</span>
                                        </a>
                                        <form action="{{ path('admin_properties_delete', {'id': property.id}) }}" method="post" class="d-inline" onsubmit="return confirm('Вы уверены, что хотите удалить это свойство?')">
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ property.id) }}">
                                            <button type="submit" class="btn btn-delete">
                                                <span>Удалить</span>
                                            </button>
                                        </form>
                                        {% else %}
                                        <span class="text-muted">Доступ запрещен</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% endif %}
            </div>
        </main>
    </div>
{% endblock %}
